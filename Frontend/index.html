<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengolahan Citra Digital</title>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --accent: #10b981;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --border-hover: #cbd5e1;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 16px;
            --radius-sm: 12px;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-main);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Container */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 1.5rem;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Card */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            transition: all 0.2s ease;
            animation: slideUp 0.5s ease-out;
        }

        .card:hover {
            box-shadow: var(--shadow);
            border-color: var(--border-hover);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Section Title */
        .section-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .section-title .icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f0f0ff, #e8f4f8);
            border-radius: 10px;
        }

        .section-title .icon svg {
            width: 18px;
            height: 18px;
            stroke: var(--primary);
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: var(--radius-sm);
            padding: 2rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-main);
        }

        .upload-zone:hover {
            border-color: var(--primary-light);
            background: #fafaff;
        }

        .upload-zone input {
            display: none;
        }

        .upload-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 0.75rem;
            stroke: var(--primary);
            opacity: 0.8;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .upload-text strong {
            color: var(--primary);
        }

        .file-name {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 10px;
            color: #15803d;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .file-name svg {
            width: 16px;
            height: 16px;
            stroke: #15803d;
        }

        /* Method Select */
        .method-select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px;
        }

        .method-select:hover {
            border-color: var(--primary-light);
        }

        .method-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .method-select option {
            padding: 0.5rem;
        }

        .method-select optgroup {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Process Button */
        .btn-process {
            width: 100%;
            margin-top: 1rem;
            padding: 0.875rem 1.5rem;
            background: var(--primary);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-process:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-process:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-process:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-process svg {
            width: 18px;
            height: 18px;
        }

        .btn-process .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Error Message */
        .error-msg {
            margin-top: 1rem;
            padding: 0.875rem 1rem;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 10px;
            color: #dc2626;
            font-size: 0.85rem;
        }

        /* Sidebar Stack */
        .sidebar-stack {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Preview Area */
        .preview-area {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .preview-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Preview Header */
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .preview-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-download {
            padding: 0.5rem 0.875rem;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            color: #15803d;
            font-family: inherit;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .btn-download:hover {
            background: #dcfce7;
        }

        .btn-download svg {
            width: 14px;
            height: 14px;
        }

        /* Image Container */
        .image-container {
            width: 100%;
            height: 400px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-main);
            border: 1px solid var(--border);
            position: relative;
        }

        .image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .image-container:hover img {
            transform: scale(1.02);
        }

        .placeholder-text {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            z-index: 10;
        }

        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Info Section */
        .info-section {
            background: linear-gradient(135deg, #fafaff, #f8fafc);
        }

        .info-section h3 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .info-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 0.5rem;
            list-style: none;
        }

        .info-list li {
            padding: 0.75rem 1rem;
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border);
            font-size: 0.825rem;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .info-list li:hover {
            border-color: var(--primary-light);
            transform: translateX(3px);
        }

        .info-list li strong {
            color: var(--text-primary);
        }

        /* Animation delays */
        .card:nth-child(1) {
            animation-delay: 0s;
        }

        .card:nth-child(2) {
            animation-delay: 0.1s;
        }
    </style>
</head>

<body>

    <div id="app" class="container">

        <!-- Header -->
        <header class="header">
            <h1>Pengolahan Citra Digital</h1>
            <p>Kelompok 2</p>
        </header>

        <!-- Main Content -->
        <div class="main-grid">

            <!-- Controls Sidebar -->
            <div class="sidebar-stack">

                <!-- Upload Section -->
                <div class="card">
                    <div class="section-title">
                        <div class="icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                            </svg>
                        </div>
                        Upload Gambar
                    </div>

                    <label for="dropzone-file" class="upload-zone">
                        <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                            </path>
                        </svg>
                        <p class="upload-text"><strong>Klik untuk upload</strong></p>
                        <p class="upload-text" style="font-size: 0.75rem; margin-top: 0.25rem; color: #94a3b8;">PNG, JPG
                            (maks. 10MB)</p>
                        <input id="dropzone-file" type="file" @change="handleFileUpload" accept="image/png, image/jpeg">
                    </label>

                    <div v-if="file" class="file-name">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        {{ file.name }}
                    </div>
                </div>

                <!-- Method Selection -->
                <div class="card">
                    <div class="section-title">
                        <div class="icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                                </path>
                            </svg>
                        </div>
                        Pilih Metode
                    </div>

                    <select v-model="selectedMethod" class="method-select">
                        <option disabled value="">-- Pilih Metode --</option>
                        <optgroup label="Dasar">
                            <option value="segmentation">Segmentasi (Otsu Threshold)</option>
                        </optgroup>
                        <optgroup label="Morfologi">
                            <option value="dilation">Dilasi (Dilation)</option>
                            <option value="erosion">Erosi (Erosion)</option>
                            <option value="opening">Opening</option>
                            <option value="closing">Closing</option>
                            <option value="region_filling">Region Filling</option>
                        </optgroup>
                        <optgroup label="Perbaikan">
                            <option value="restoration">Restorasi (Denoising)</option>
                        </optgroup>
                        <optgroup label="Deteksi Tepi">
                            <option value="sobel">Sobel</option>
                            <option value="roberts">Roberts Cross</option>
                            <option value="prewitt">Prewitt</option>
                            <option value="laplacian">Laplacian</option>
                            <option value="freichan">Frei-Chen</option>
                        </optgroup>
                    </select>

                    <button @click="processImage" :disabled="!file || !selectedMethod || isLoading" class="btn-process">
                        <div v-if="isLoading" class="spinner"></div>
                        <svg v-else fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        {{ isLoading ? 'Memproses...' : 'Proses Gambar' }}
                    </button>

                    <div v-if="errorMessage" class="error-msg">
                        {{ errorMessage }}
                    </div>
                </div>
            </div>

            <!-- Preview Area -->
            <div class="preview-area">
                <div class="preview-grid">

                    <!-- Original Image -->
                    <div class="card">
                        <div class="preview-header">
                            <span class="preview-label">Gambar Asli</span>
                        </div>
                        <div class="image-container">
                            <img v-if="previewUrl" :src="previewUrl" alt="Preview Asli">
                            <span v-else class="placeholder-text">Belum ada gambar</span>
                        </div>
                    </div>

                    <!-- Processed Image -->
                    <div class="card">
                        <div class="preview-header">
                            <span class="preview-label">Hasil Pemrosesan</span>
                            <button v-if="processedImage" @click="downloadResult" class="btn-download">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Download
                            </button>
                        </div>
                        <div class="image-container">
                            <div v-if="isLoading" class="loading-overlay">
                                <div class="loading-spinner"></div>
                                <span class="loading-text">Memproses...</span>
                            </div>
                            <img v-if="processedImage" :src="processedImage" alt="Hasil Proses">
                            <span v-else class="placeholder-text">Hasil akan muncul di sini</span>
                        </div>
                    </div>

                </div>

                <!-- Info Section -->
                <div class="card info-section">
                    <h3>ðŸ“– Informasi Metode</h3>
                    <ul class="info-list">
                        <li><strong>Segmentasi:</strong> Memisahkan objek dari background dengan Otsu</li>
                        <li><strong>Dilasi/Erosi:</strong> Menambah atau mengikis piksel batas objek</li>
                        <li><strong>Opening/Closing:</strong> Menghilangkan noise atau menutup lubang</li>
                        <li><strong>Region Filling:</strong> Mengisi area tertutup di dalam objek</li>
                        <li><strong>Restorasi:</strong> Mengurangi noise pada gambar</li>
                        <li><strong>Sobel:</strong> Deteksi tepi dengan gradien Sobel</li>
                        <li><strong>Roberts:</strong> Deteksi tepi dengan operator diagonal</li>
                        <li><strong>Prewitt:</strong> Deteksi tepi dengan kernel 3x3</li>
                        <li><strong>Laplacian:</strong> Deteksi tepi dengan turunan kedua</li>
                        <li><strong>Frei-Chen:</strong> Deteksi tepi dengan 9 basis masks</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref } = Vue;

        createApp({
            setup() {
                const file = ref(null);
                const previewUrl = ref(null);
                const selectedMethod = ref("");
                const processedImage = ref(null);
                const isLoading = ref(false);
                const errorMessage = ref(null);

                const handleFileUpload = (event) => {
                    const uploadedFile = event.target.files[0];
                    if (uploadedFile) {
                        file.value = uploadedFile;
                        previewUrl.value = URL.createObjectURL(uploadedFile);
                        processedImage.value = null;
                        errorMessage.value = null;
                    }
                };

                const processImage = async () => {
                    if (!file.value || !selectedMethod.value) return;

                    isLoading.value = true;
                    errorMessage.value = null;

                    const formData = new FormData();
                    formData.append('file', file.value);
                    formData.append('method', selectedMethod.value);

                    try {
                        // Auto-detect: gunakan localhost untuk development, /api/process untuk production
                        const apiUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                            ? 'http://127.0.0.1:8000/process'
                            : '/api/process';
                        const response = await axios.post(apiUrl, formData, {
                            headers: { 'Content-Type': 'multipart/form-data' }
                        });
                        processedImage.value = response.data.image_base64;
                    } catch (error) {
                        console.error(error);
                        errorMessage.value = "Gagal memproses. Pastikan backend berjalan di port 8000.";
                    } finally {
                        isLoading.value = false;
                    }
                };

                const downloadResult = () => {
                    if (!processedImage.value) return;
                    const link = document.createElement('a');
                    link.href = processedImage.value;
                    link.download = `hasil_${selectedMethod.value}_${Date.now()}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };

                return {
                    file, previewUrl, selectedMethod, processedImage,
                    isLoading, errorMessage, handleFileUpload, processImage, downloadResult
                };
            }
        }).mount('#app');
    </script>
</body>

</html>